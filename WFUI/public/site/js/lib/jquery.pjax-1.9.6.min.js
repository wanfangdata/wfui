/*!
 * Copyright 2012, Chris Wanstrath
 * Released under the MIT License
 * https://github.com/defunkt/jquery-pjax
 */
(function(n){function rt(t,i,r){var u=this;return this.on("click.pjax",t,function(t){var f=n.extend({},e(i,r));f.container||(f.container=n(this).attr("data-pjax")||u);v(t,f)})}function v(i,r,u){var f;if(u=e(r,u),f=i.currentTarget,f.tagName.toUpperCase()!=="A")throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(i.which>1)&&!i.metaKey&&!i.ctrlKey&&!i.shiftKey&&!i.altKey&&location.protocol===f.protocol&&location.hostname===f.hostname&&(!(f.href.indexOf("#")>-1)||d(f)!=d(location))&&!i.isDefaultPrevented()){var h={url:f.href,container:n(f).attr("data-pjax"),target:f},o=n.extend({},h,u),s=n.Event("pjax:click");n(f).trigger(s,[o]);s.isDefaultPrevented()||(t(o),i.preventDefault(),n(f).trigger("pjax:clicked",[o]))}}function ut(i,r,u){var f,o;if(u=e(r,u),f=i.currentTarget,f.tagName.toUpperCase()!=="FORM")throw"$.pjax.submit requires a form element";if(o={type:f.method.toUpperCase(),url:f.action,container:n(f).attr("data-pjax"),target:f},o.type!=="GET"&&window.FormData!==undefined)o.data=new FormData(f),o.processData=!1,o.contentType=!1;else{if(n(f).find(":file").length)return;o.data=n(f).serializeArray()}t(n.extend({},o,u));i.preventDefault()}function t(i){function e(t,i,r){r||(r={});r.relatedTarget=c;var f=n.Event(t,r);return u.trigger(f,i),!f.isDefaultPrevented()}var h,s;i=n.extend(!0,{},n.ajaxSettings,t.defaults,i);n.isFunction(i.url)&&(i.url=i.url());var c=i.target,o=f(i.url).hash,u=i.context=g(i.container);return i.data||(i.data={}),n.isArray(i.data)?i.data.push({name:"_pjax",value:u.selector}):i.data._pjax=u.selector,i.beforeSend=function(n,t){if(t.type!=="GET"&&(t.timeout=0),n.setRequestHeader("X-PJAX","true"),n.setRequestHeader("X-PJAX-Container",u.selector),!e("pjax:beforeSend",[n,t]))return!1;t.timeout>0&&(h=setTimeout(function(){e("pjax:timeout",[n,i])&&n.abort("timeout")},t.timeout),t.timeout=0);var r=f(t.url);o&&(r.hash=o);i.requestUrl=k(r)},i.complete=function(n,t){h&&clearTimeout(h);e("pjax:complete",[n,t,i]);e("pjax:end",[n,i])},i.error=function(n,t,u){var f=nt("",n,i),o=e("pjax:error",[n,t,u,i]);i.type=="GET"&&t!=="abort"&&o&&r(f.url)},i.success=function(s,h,c){var g=t.state,b=typeof n.pjax.defaults.version=="function"?n.pjax.defaults.version():n.pjax.defaults.version,k=c.getResponseHeader("X-PJAX-Version"),l=nt(s,c,i),d=f(l.url),a,v,y,p;if(o&&(d.hash=o,l.url=d.href),b&&k&&b!==k){r(l.url);return}if(!l.contents){r(l.url);return}t.state={id:i.id||w(),url:l.url,title:l.title,container:u.selector,fragment:i.fragment,timeout:i.timeout};(i.push||i.replace)&&window.history.replaceState(t.state,l.title,l.url);try{document.activeElement.blur()}catch(tt){}l.title&&(document.title=l.title);e("pjax:beforeReplace",[l.contents,i],{state:t.state,previousState:g});u.html(l.contents);a=u.find("input[autofocus], textarea[autofocus]").last()[0];a&&document.activeElement!==a&&a.focus();st(l.scripts);v=i.scrollTo;o&&(y=decodeURIComponent(o.slice(1)),p=document.getElementById(y)||document.getElementsByName(y)[0],p&&(v=n(p).offset().top));typeof v=="number"&&n(window).scrollTop(v);e("pjax:success",[s,h,c,i])},t.state||(t.state={id:w(),url:window.location.href,title:document.title,container:u.selector,fragment:i.fragment,timeout:i.timeout},window.history.replaceState(t.state,document.title)),p(t.xhr),t.options=i,s=t.xhr=n.ajax(i),s.readyState>0&&(i.push&&!i.replace&&(ht(t.state.id,b(u)),window.history.pushState(null,"",i.requestUrl)),e("pjax:start",[s,i]),e("pjax:send",[s,i])),t.xhr}function ft(i,r){var u={url:window.location.href,push:!1,replace:!0,scrollTo:!1};return t(n.extend(u,e(i,r)))}function r(n){window.history.replaceState(null,"",t.state.url);window.location.replace(n)}function y(f){var s,e,c,v,h,y;if(u||p(t.xhr),s=t.state,e=f.state,e&&e.container){if(u&&et==e.url)return;if(s){if(s.id===e.id)return;c=s.id<e.id?"forward":"back"}var a=i[e.id]||[],o=n(a[0]||e.container),l=a[1];o.length?(s&&ct(c,s.id,b(o)),v=n.Event("pjax:popstate",{state:e,direction:c}),o.trigger(v),h={id:e.id,url:e.url,container:o,push:!1,fragment:e.fragment,timeout:e.timeout,scrollTo:!1},l?(o.trigger("pjax:start",[null,h]),t.state=e,e.title&&(document.title=e.title),y=n.Event("pjax:beforeReplace",{state:e,previousState:s}),o.trigger(y,[l,h]),o.html(l),o.trigger("pjax:end",[null,h])):t(h),o[0].offsetHeight):r(location.href)}u=!1}function ot(t){var e=n.isFunction(t.url)?t.url():t.url,u=t.type?t.type.toUpperCase():"GET",r=n("<form>",{method:u==="GET"?"GET":"POST",action:e,style:"display:none"}),i,f;if(u!=="GET"&&u!=="POST"&&r.append(n("<input>",{type:"hidden",name:"_method",value:u.toLowerCase()})),i=t.data,typeof i=="string")n.each(i.split("&"),function(t,i){var u=i.split("=");r.append(n("<input>",{type:"hidden",name:u[0],value:u[1]}))});else if(n.isArray(i))n.each(i,function(t,i){r.append(n("<input>",{type:"hidden",name:i.name,value:i.value}))});else if(typeof i=="object")for(f in i)r.append(n("<input>",{type:"hidden",name:f,value:i[f]}));n(document.body).append(r);r.submit()}function p(t){t&&t.readyState<4&&(t.onreadystatechange=n.noop,t.abort())}function w(){return(new Date).getTime()}function b(n){var t=n.clone();return t.find("script").each(function(){this.src||jQuery._data(this,"globalEval",!1)}),[n.selector,t.contents()]}function k(n){return n.search=n.search.replace(/([?&])(_pjax|_)=[^&]*/g,""),n.href.replace(/\?($|#)/,"$1")}function f(n){var t=document.createElement("a");return t.href=n,t}function d(n){return n.href.replace(/#.*/,"")}function e(t,i){return t&&i?i.container=t:i=n.isPlainObject(t)?t:{container:t},i.container&&(i.container=g(i.container)),i}function g(t){if(t=n(t),t.length){if(t.selector!==""&&t.context===document)return t;if(t.attr("id"))return n("#"+t.attr("id"));throw"cant get selector for pjax container!";}else throw"no pjax container for "+t.selector;}function h(n,t){return n.filter(t).add(n.find(t))}function c(t){return n.parseHTML(t,document,!0)}function nt(t,i,r){var u={},l=/<html/i.test(t),a=i.getResponseHeader("X-PJAX-URL"),e,s,o;return(u.url=a?k(f(a)):r.requestUrl,l?(s=n(c(t.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0])),e=n(c(t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]))):s=e=n(c(t)),e.length===0)?u:(u.title=h(s,"title").last().text(),r.fragment?(o=r.fragment==="body"?e:h(e,r.fragment).first(),o.length&&(u.contents=r.fragment==="body"?o:o.contents(),u.title||(u.title=o.attr("title")||o.data("title")))):l||(u.contents=e),u.contents&&(u.contents=u.contents.not(function(){return n(this).is("title")}),u.contents.find("title").remove(),u.scripts=h(u.contents,"script[src]").remove(),u.contents=u.contents.not(u.scripts)),u.title&&(u.title=n.trim(u.title)),u)}function st(t){if(t){var i=n("script[src]");t.each(function(){var u=this.src,f=i.filter(function(){return this.src===u}),t,r;f.length||(t=document.createElement("script"),r=n(this).attr("type"),r&&(t.type=r),t.src=n(this).attr("src"),document.head.appendChild(t))})}}function ht(n,r){i[n]=r;o.push(n);a(l,0);a(o,t.defaults.maxCacheLength)}function ct(n,r,u){var f,e;i[r]=u;n==="forward"?(f=o,e=l):(f=l,e=o);f.push(r);(r=e.pop())&&delete i[r];a(f,t.defaults.maxCacheLength)}function a(n,t){while(n.length>t)delete i[n.shift()]}function lt(){return n("meta").filter(function(){var t=n(this).attr("http-equiv");return t&&t.toUpperCase()==="X-PJAX-VERSION"}).attr("content")}function tt(){n.fn.pjax=rt;n.pjax=t;n.pjax.enable=n.noop;n.pjax.disable=it;n.pjax.click=v;n.pjax.submit=ut;n.pjax.reload=ft;n.pjax.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20,version:lt};n(window).on("popstate.pjax",y)}function it(){n.fn.pjax=function(){return this};n.pjax=ot;n.pjax.enable=tt;n.pjax.disable=n.noop;n.pjax.click=n.noop;n.pjax.submit=n.noop;n.pjax.reload=function(){window.location.reload()};n(window).off("popstate.pjax",y)}var u=!0,et=window.location.href,s=window.history.state;s&&s.container&&(t.state=s);"state"in window.history&&(u=!1);var i={},l=[],o=[];n.inArray("state",n.event.props)<0&&n.event.props.push("state");n.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/);n.support.pjax?tt():it()})(jQuery);